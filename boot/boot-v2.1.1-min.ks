{GLOBAL KnuPanic IS{PARAMETER A,B.HUDTEXT("KNUPANIC!",5,2,30,RED,TRUE).PRINT Z+"@"+B+":"+A. WAIT 60.REBOOT.}.GLOBAL HasKSCConnection IS{IF ADDONS:AVAILABLE("RT") RETURN ADDONS:RT:HasKSCConnection(SHIP).ELSE RETURN HOMECONNECTION:ISCONNECTED.}.LOCAL Z IS 0.GLOBAL Error IS{PARAMETER A,B IS FALSE. SET Z TO A. RETURN B.}.GLOBAL Success IS{PARAMETER A IS TRUE. SET Z TO 0.RETURN A.}.GLOBAL LastError IS{LOCAL A IS Z. SET Z TO 0.RETURN A.}.GLOBAL JF IS{PARAMETER A.RETURN A:ISTYPE("Boolean")AND NOT A.}.GLOBAL GetKSCFile IS{PARAMETER A,B IS A,D IS 0.IF (NOT D)AND EXISTS(B)RETURN Error(-1).IF NOT HasKSCConnection()RETURN Error(-4).LOCAL F IS VOLUME(0):OPEN(A).IF JF(F)RETURN Error(-3).IF VOLUME(1):FREESPACE<F:SIZE RETURN Error(-2).COPYPATH("0:"+A,"1:"+B).RETURN Success().}.GLOBAL GetLatestVersion IS{PARAMETER A,B,D IS 0,F IS 0.LOCAL H IS path(B+"/"+A).SET A TO H:NAME. SET B TO "/"+H:PARENT:SEGMENTS:JOIN("/").LOCAL J IS VOLUME(F):OPEN(B):LIST:VALUES:REVERSEITERATOR. UNTIL NOT J:NEXT IF J:VALUE:NAME:MATCHESPATTERN("^"+A+"(-v[0-9]+(\.[0-9]+){0,3}){0,1}(-min){"+D+",1}\.ks$")RETURN Success(B+"/"+J:VALUE).RETURN Error(-3).}.IF NOT EXISTS("/boot/knuldr")IF NOT GetKSCFile(GetLatestVersion("knuldr","/knulib"),"/boot/knuldr",SHIP:STATUS="PRELAUNCH")IF Z<>-1 KnuPanic(scriptpath(),57).}RUNPATH("/boot/knuldr").